{"version":3,"sources":["backstage-category.js"],"names":["orderInfo","document","querySelector","deleteAll","orderList","orderListInit","getOrderList","axios","get","api_path","headers","token","then","response","data","orders","renderOrderList","renderOrderChart","error","console","log","orderListCategory","objCategoty","forEach","item","products","product","category","undefined","price","arrCategory","Object","keys","arrCategoryPrice","push","chart","c3","generate","columns","type","onclick","d","i","colors","str","productStr","itemProduct","content","title","quantity","orderStatus","paid","createdAt","user","name","tel","address","email","id","innerHTML","addEventListener","deleteAllOrder","e","orderId","target","getAttribute","deleteOrderItem","orderPaid","updateStatus","put"],"mappings":"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","sourcesContent":["const orderInfo = document.querySelector(\".js-orderInfo\")\nconst deleteAll = document.querySelector(\".js-deleteAll\")\n\nlet orderList = [];\n\n\n\n\n\n\n// setTimeout(function () {\n//   chart.load({\n//     columns: [\n//       [\"setosa\", 0.2, 0.2, 0.2, 0.2, 0.2, 0.4, 0.3, 0.2, 0.2, 0.1, 0.2, 0.2, 0.1, 0.1, 0.2, 0.4, 0.4, 0.3, 0.3, 0.3, 0.2, 0.4, 0.2, 0.5, 0.2, 0.2, 0.4, 0.2, 0.2, 0.2, 0.2, 0.4, 0.1, 0.2, 0.2, 0.2, 0.2, 0.1, 0.2, 0.2, 0.3, 0.3, 0.2, 0.6, 0.4, 0.3, 0.2, 0.2, 0.2, 0.2],\n//       [\"versicolor\", 1.4, 1.5, 1.5, 1.3, 1.5, 1.3, 1.6, 1.0, 1.3, 1.4, 1.0, 1.5, 1.0, 1.4, 1.3, 1.4, 1.5, 1.0, 1.5, 1.1, 1.8, 1.3, 1.5, 1.2, 1.3, 1.4, 1.4, 1.7, 1.5, 1.0, 1.1, 1.0, 1.2, 1.6, 1.5, 1.6, 1.5, 1.3, 1.3, 1.3, 1.2, 1.4, 1.2, 1.0, 1.3, 1.2, 1.3, 1.3, 1.1, 1.3],\n//       [\"virginica\", 2.5, 1.9, 2.1, 1.8, 2.2, 2.1, 1.7, 1.8, 1.8, 2.5, 2.0, 1.9, 2.1, 2.0, 2.4, 2.3, 1.8, 2.2, 2.3, 1.5, 2.3, 2.0, 2.0, 1.8, 2.1, 1.8, 1.8, 1.8, 2.1, 1.6, 1.9, 2.0, 2.2, 1.5, 1.4, 2.3, 2.4, 1.8, 1.8, 2.1, 2.4, 2.3, 1.9, 2.3, 2.5, 2.3, 1.9, 2.0, 2.3, 1.8],\n//     ]\n//   });\n// }, 1500);\n\n// setTimeout(function () {\n//   chart.unload({\n//     ids: 'data1'\n//   });\n//   chart.unload({\n//     ids: 'data2'\n//   });\n// }, 2500);\n\nfunction orderListInit() {\n  getOrderList();\n};\n\norderListInit();\n\n\n// 取得訂單列表\nfunction getOrderList() {\n  axios.get(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders`,\n    {\n      headers: {\n        'Authorization': token\n      }\n    })\n    .then(function (response) {\n      orderList = response.data.orders;\n      // console.log(orderList);\n      renderOrderList();\n      renderOrderChart()\n    })\n    .catch(function (error) {\n      console.log(error.response.data);\n    })\n}\n\n// 渲染上方圓餅圖 c3.js\nfunction renderOrderChart() {\n  let orderListCategory = [];\n\n  let objCategoty = {};\n\n  // 篩選資料\n  orderList.forEach(function (item) {\n    item.products.forEach(function (product) {\n      if (objCategoty[product.category] == undefined) {\n        objCategoty[product.category] = product.price;\n      } else {\n        objCategoty[product.category] += product.price;\n      }\n    })\n  })\n\n  // 處理資料\n  let arrCategory = Object.keys(objCategoty);\n\n  arrCategory.forEach(function (item) {\n    let arrCategoryPrice = [];\n    arrCategoryPrice.push(item);\n    arrCategoryPrice.push(objCategoty[item]);\n\n    orderListCategory.push(arrCategoryPrice);\n  })\n\n  // 套入C3.js\n  let chart = c3.generate({\n    data: {\n      // iris data from R\n      columns: orderListCategory,\n      type: 'pie',\n      onclick: function (d, i) { console.log(\"onclick\", d, i); },\n      colors: {\n        \"床架\": \"#6A33F8\",\n        \"窗簾\": \"#DACBFF\",\n        \"收納\": \"#5434A7\",\n      }\n    }\n  });\n}\n\n\n// 渲染下方訂單列表\nfunction renderOrderList() {\n\n  let str = \"\";\n\n  orderList.forEach(function (item) {\n\n    // 遍歷訂購產品\n    let productStr = \"\";\n\n    item.products.forEach(function (itemProduct) {\n      let content = `\n        <li>${itemProduct.title}(${itemProduct.quantity})</li>\n        `;\n\n      productStr += content;\n    })\n    // 遍歷訂購產品\n\n\n\n    // 判斷訂單狀態\n    let orderStatus = \"\";\n    if (item.paid === false) {\n      orderStatus = \"未處理\";\n    } else if (item.paid === true) {\n      orderStatus = \"已處理\";\n    }\n    // 判斷訂單狀態\n\n\n    let content = `\n      <div class=\"col-span-3 border flex justify-center items-center\">\n        <p>${item.createdAt}</p>\n      </div>\n      <div class=\"col-span-3 border flex flex-col justify-center items-start pl-3 py-2\">\n        <p>${item.user.name}</p>\n        <p>${item.user.tel}</p>\n      </div>\n      <div class=\"col-span-5 border flex items-center px-3\">\n        <p>${item.user.address}</p>\n      </div>\n      <div class=\"col-span-5 border flex justify-center items-center\">\n        <p>${item.user.email}</p>\n      </div>\n      <ul class=\"col-span-4 border text-center py-2\">\n          ${productStr}\n      </ul>\n      <div class=\"col-span-3 border flex justify-center items-center\">\n        <p>2021/03/08</p>\n      </div>\n      <div class=\"col-span-2 border flex justify-center items-center\">\n        <a class=\"text-blue-500 underline leading-7 cursor-pointer\" data-orderStatus=\"orderStatus\" data-orderPaid=\"${item.paid}\" data-orderId=\"${item.id}\">${orderStatus}</a>\n      </div>\n      <div class=\"col-span-2 border flex justify-center items-center\">\n        <input type=\"button\" class=\"bg-gray-100 rounded-sm px-3 py-1 cursor-pointer hover:bg-red-600 hover:text-white\"\n          value=\"刪除\" data-deleteOrder=\"deleteOrder\" data-orderId=\"${item.id}\">\n      </div>\n    `\n\n    str += content;\n  });\n\n  orderInfo.innerHTML = str;\n}\n\n// 清除全部訂單\ndeleteAll.addEventListener(\"click\", function () {\n  deleteAllOrder();\n});\n\nfunction deleteAllOrder() {\n  axios.delete(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders`,\n    {\n      headers: {\n        'Authorization': token\n      }\n    })\n    .then(function (response) {\n      console.log(response.data);\n      orderListInit();\n    })\n    .catch(function (error) {\n      console.log(error.response.data);\n    })\n}\n\n\n// 刪除特定訂單\norderInfo.addEventListener(\"click\", function (e) {\n  const orderId = e.target.getAttribute(\"data-orderId\");\n  if (e.target.getAttribute(\"data-deleteOrder\") !== \"deleteOrder\") {\n    // console.log(\"點擊錯誤\");\n  } else {\n    console.log(\"點擊正確\");\n    console.log(orderId);\n    deleteOrderItem(orderId)\n  }\n})\n\nfunction deleteOrderItem(orderId) {\n  axios.delete(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders/${orderId}`,\n    {\n      headers: {\n        'Authorization': token\n      }\n    })\n    .then(function (response) {\n      console.log(response.data);\n      orderListInit();\n    })\n}\n\n// 更改訂單狀態\norderInfo.addEventListener(\"click\", function (e) {\n  const orderStatus = e.target.getAttribute(\"data-orderStatus\");\n  const orderPaid = e.target.getAttribute(\"data-orderPaid\");\n  const orderId = e.target.getAttribute(\"data-orderId\");\n\n  if (orderStatus !== \"orderStatus\") {\n    console.log(\"點擊錯誤\");\n  } else {\n    console.log(\"點擊正確\");\n    console.log(orderPaid);\n    console.log(orderId);\n\n    let updateStatus;\n\n    if (orderPaid == \"false\") {\n      updateStatus = true;\n    } else if (orderPaid == \"true\") {\n      updateStatus = false;\n    }\n\n    console.log(updateStatus);\n\n    axios.put(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders`,\n      {\n        \"data\": {\n          \"id\": orderId,\n          \"paid\": updateStatus\n        }\n      },\n      {\n        headers: {\n          'Authorization': token\n        }\n      })\n      .then(function (response) {\n        console.log(response.data);\n        orderListInit();\n      })\n\n  }\n})\n"],"file":"backstage-category.js"}